<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="2" skipped="0" tests="121" time="10.777" timestamp="2025-12-07T15:31:45.046937-08:00" hostname="MacBookPro.lan"><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientInstantiation" name="test_client_instantiates_with_defaults" time="0.257" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientInstantiation" name="test_client_instantiates_with_custom_config" time="0.000" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientInstantiation" name="test_client_instantiates_from_env" time="0.001" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientContextManager" name="test_context_manager_creates_client" time="0.114" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientContextManager" name="test_context_manager_closes_client" time="0.022" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientContextManager" name="test_context_manager_reuses_connection_pool" time="0.023" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientChatCompletion" name="test_chat_completion_success" time="0.024" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientChatCompletion" name="test_chat_completion_validates_messages" time="0.022" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientChatCompletion" name="test_chat_completion_timeout_handling" time="0.024" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientRetryLogic" name="test_retry_on_503_service_unavailable" time="0.056" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientRetryLogic" name="test_retry_on_429_rate_limit" time="0.036" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientRetryLogic" name="test_no_retry_on_4xx_client_error" time="0.024" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientRetryLogic" name="test_exhausted_retries_raises_error" time="0.057" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientRetryLogic" name="test_retry_uses_exponential_backoff" time="0.181" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientErrorClassification" name="test_classify_transient_error_503" time="0.001" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientErrorClassification" name="test_classify_transient_error_429" time="0.000" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientErrorClassification" name="test_classify_transient_error_502" time="0.000" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientErrorClassification" name="test_classify_non_transient_error_400" time="0.001" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientErrorClassification" name="test_classify_non_transient_error_401" time="0.001" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientErrorClassification" name="test_classify_non_transient_error_404" time="0.000" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientErrorClassification" name="test_health_check_success" time="0.025" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientErrorClassification" name="test_health_check_failure" time="0.023" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientSessionManagement" name="test_create_session_returns_session_id" time="0.023" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientSessionManagement" name="test_create_session_with_ttl_and_context" time="0.023" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientSessionManagement" name="test_get_session_returns_session_state" time="0.024" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientSessionManagement" name="test_get_session_not_found" time="0.024" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientSessionManagement" name="test_delete_session_success" time="0.025" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientSessionManagement" name="test_delete_session_not_found" time="0.023" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientToolExecution" name="test_execute_tool_returns_result" time="0.022" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientToolExecution" name="test_execute_tool_with_error" time="0.023" /><testcase classname="tests_unit.clients.test_llm_gateway.TestLLMGatewayClientToolExecution" name="test_execute_tool_api_error" time="0.023" /><testcase classname="tests_unit.config.test_gateway_config.TestGatewayConfig" name="test_default_values" time="0.001" /><testcase classname="tests_unit.config.test_gateway_config.TestGatewayConfig" name="test_loads_from_env" time="0.001" /><testcase classname="tests_unit.config.test_gateway_config.TestGatewayConfig" name="test_validates_timeout_positive" time="0.001" /><testcase classname="tests_unit.config.test_gateway_config.TestGatewayConfig" name="test_validates_session_ttl_minimum" time="0.001" /><testcase classname="tests_unit.config.test_gateway_config.TestGatewayConfig" name="test_validates_url_scheme" time="0.001" /><testcase classname="tests_unit.config.test_gateway_config.TestGatewayConfig" name="test_accepts_https_url" time="0.001" /><testcase classname="tests_unit.config.test_gateway_config.TestSettingsWithGateway" name="test_settings_includes_gateway_config" time="0.001" /><testcase classname="tests_unit.config.test_gateway_config.TestSettingsWithGateway" name="test_settings_display_includes_gateway" time="0.001" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderInstantiation" name="test_instantiation_with_defaults" time="0.000" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderInstantiation" name="test_instantiation_with_custom_model" time="0.000" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderInstantiation" name="test_instantiation_with_custom_gateway_url" time="0.000" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderInstantiation" name="test_implements_llm_provider_protocol" time="0.000" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderCall" name="test_call_returns_llm_response" time="0.001" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderCall" name="test_call_with_system_prompt" time="0.001" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderCall" name="test_call_converts_prompt_to_messages_format" time="0.001" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderErrorHandling" name="test_call_raises_llm_error_on_gateway_failure" time="0.001" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderErrorHandling" name="test_call_raises_llm_error_on_timeout" time="0.001" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderErrorHandling" name="test_call_raises_llm_error_on_connection_failure" time="0.001" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderAsyncBridge" name="test_call_is_synchronous" time="0.001" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderAsyncBridge" name="test_call_async_available_for_async_contexts" time="0.001" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderResponseParsing" name="test_parses_stop_reason_from_response" time="0.000" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderResponseParsing" name="test_handles_max_tokens_finish_reason" time="0.001" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderResponseParsing" name="test_handles_tool_calls_finish_reason" time="0.001" /><testcase classname="tests_unit.providers.test_gateway_provider.TestGatewayProviderFactoryIntegration" name="test_factory_can_create_gateway_provider" time="0.000" /><testcase classname="tests_unit.scripts.test_llm_evaluation.TestUnusedParameterFixes" name="test_deepseek_connection_uses_api_key_or_underscore" time="2.868" /><testcase classname="tests_unit.scripts.test_llm_evaluation.TestUnusedParameterFixes" name="test_gemini_connection_uses_api_key_or_underscore" time="0.008" /><testcase classname="tests_unit.scripts.test_run_comprehensive_evaluation.TestNotSetConstant" name="test_not_set_constant_exists" time="0.002" /><testcase classname="tests_unit.scripts.test_run_comprehensive_evaluation.TestNotSetConstant" name="test_not_set_constant_value" time="0.001" /><testcase classname="tests_unit.scripts.test_run_comprehensive_evaluation.TestNotSetConstant" name="test_verify_prerequisites_uses_constant" time="0.002" /><testcase classname="tests_unit.scripts.test_run_comprehensive_evaluation.TestFStringWithoutPlaceholder" name="test_no_empty_fstring_in_dry_run" time="0.002" /><testcase classname="tests_unit.scripts.test_run_comprehensive_evaluation.TestRunDryRunComplexity" name="test_helper_functions_exist" time="0.001" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionInstantiation" name="test_instantiation_with_defaults" time="0.003" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionInstantiation" name="test_instantiation_with_custom_ttl" time="0.000" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionInstantiation" name="test_instantiation_with_context" time="0.000" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionContextManager" name="test_aenter_creates_session" time="0.001" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionContextManager" name="test_aexit_deletes_session" time="0.001" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionContextManager" name="test_aexit_handles_delete_failure_gracefully" time="0.001" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionLifecycle" name="test_session_id_property_returns_id_when_created" time="0.001" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionLifecycle" name="test_session_id_property_returns_none_before_create" time="0.000" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionLifecycle" name="test_is_active_returns_true_when_session_valid" time="0.001" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionLifecycle" name="test_is_active_returns_false_when_expired" time="0.004" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionEnhance" name="test_enhance_passes_session_id_to_gateway" time="0.002" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionEnhance" name="test_enhance_returns_response_content" time="0.001" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionExpiry" name="test_refresh_session_on_expiry" time="0.001" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionExpiry" name="test_raises_on_expiry_when_auto_refresh_false" time="0.001" /><testcase classname="tests_unit.sessions.test_enhancement_session.TestEnhancementSessionIntegration" name="test_multi_turn_enhancement_maintains_context" time="0.002" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolDefinitions" name="test_search_corpus_tool_has_required_fields" time="0.000" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolDefinitions" name="test_search_corpus_tool_query_required" time="0.000" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolDefinitions" name="test_get_chapter_tool_has_required_fields" time="0.000" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolDefinitions" name="test_get_chapter_tool_both_params_required" time="0.000" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolDefinitions" name="test_get_related_chapters_tool_has_required_fields" time="0.000" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolDefinitions" name="test_list_books_tool_has_no_required_params" time="0.000" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolDefinitions" name="test_get_all_enhancement_tools_returns_all_tools" time="0.000" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolDefinitions" name="test_tool_names_constant_matches_definitions" time="0.000" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolHandlers" name="test_execute_tool_unknown_tool_raises" time="0.001" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolHandlers" name="test_list_books_returns_books_list" time="0.003" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolHandlers" name="test_get_chapter_returns_chapter_info" time="0.001" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolHandlers" name="test_get_chapter_not_found_returns_error" time="0.001" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolHandlers" name="test_execute_tool_dispatches_to_correct_handler" time="0.001" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolSchemaValidation" name="test_all_tools_have_description" time="0.000" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolSchemaValidation" name="test_all_parameter_properties_have_types" time="0.000" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolSchemaValidation" name="test_all_parameter_properties_have_descriptions" time="0.000" /><testcase classname="tests_unit.tools.test_tool_definitions.TestToolSchemaValidation" name="test_parameters_schema_is_object_type" time="0.000" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPassA_RegexPatterns" name="test_standard_chapter_format" time="0.035"><failure message="AssertionError: assert 2 == 3&#10; +  where 2 = len([{'detection_method': 'regex_chapter', 'end_page': 19, 'number': 1, 'start_page': 10, ...}, {'detection_method': 'regex_chapter', 'end_page': 20, 'number': 2, 'start_page': 20, ...}])">self = &lt;test_chapter_segmenter.TestPassA_RegexPatterns object at 0x129824e10&gt;
segmenter = &lt;workflows.pdf_to_json.scripts.chapter_segmenter.ChapterSegmenter object at 0x16657bb60&gt;
sample_pages_standard = [{'content': 'Chapter 1: Introduction\n\nThis is content. This is content. This is content. This is content. This is c...ntent. Final content. Final content. Final content. Final content. Final content. Final content. ', 'page_number': 20}]

    def test_standard_chapter_format(self, segmenter, sample_pages_standard):
        """Test detection of 'Chapter N: Title' format."""
        chapters = segmenter.segment_book(sample_pages_standard)
    
&gt;       assert len(chapters) == 3
E       AssertionError: assert 2 == 3
E        +  where 2 = len([{'detection_method': 'regex_chapter', 'end_page': 19, 'number': 1, 'start_page': 10, ...}, {'detection_method': 'regex_chapter', 'end_page': 20, 'number': 2, 'start_page': 20, ...}])

tests_unit/workflows/pdf_to_json/test_chapter_segmenter.py:164: AssertionError</failure></testcase><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPassA_RegexPatterns" name="test_item_format_detection" time="0.033" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPassA_RegexPatterns" name="test_numeric_format_detection" time="0.029" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPassA_RegexPatterns" name="test_yake_validation_filters_toc" time="0.015" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPassA_RegexPatterns" name="test_duplicate_chapter_numbers_ignored" time="0.145" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPassB_TopicShift" name="test_topic_shift_detection" time="0.026" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPassB_TopicShift" name="test_minimum_chapter_length_enforced" time="0.036"><failure message="assert 6 &gt;= 8&#10; +  where 8 = ChapterSegmentationConfig(min_pages=8, target_pages=20, similarity_threshold=0.25, min_chapters=3, max_chapters=80, min_keywords=3, tfidf_max_features=5000).min_pages&#10; +    where ChapterSegmentationConfig(min_pages=8, target_pages=20, similarity_threshold=0.25, min_chapters=3, max_chapters=80, min_keywords=3, tfidf_max_features=5000) = &lt;workflows.pdf_to_json.scripts.chapter_segmenter.ChapterSegmenter object at 0x16660d9d0&gt;.config">self = &lt;test_chapter_segmenter.TestPassB_TopicShift object at 0x129825310&gt;
segmenter = &lt;workflows.pdf_to_json.scripts.chapter_segmenter.ChapterSegmenter object at 0x16660d9d0&gt;

    def test_minimum_chapter_length_enforced(self, segmenter):
        """Test that minimum chapter length (8 pages) is enforced."""
        # Pages with frequent topic shifts (every 3 pages)
        pages = [
            {"page_number": i, "content": f"Topic {i//3} content. " * 100}
            for i in range(1, 31)
        ]
    
        chapters = segmenter.segment_book(pages)
    
        # All chapters should be &gt;= min_pages (8)
        for chapter in chapters:
            chapter_length = chapter["end_page"] - chapter["start_page"] + 1
&gt;           assert chapter_length &gt;= segmenter.config.min_pages
E           assert 6 &gt;= 8
E            +  where 8 = ChapterSegmentationConfig(min_pages=8, target_pages=20, similarity_threshold=0.25, min_chapters=3, max_chapters=80, min_keywords=3, tfidf_max_features=5000).min_pages
E            +    where ChapterSegmentationConfig(min_pages=8, target_pages=20, similarity_threshold=0.25, min_chapters=3, max_chapters=80, min_keywords=3, tfidf_max_features=5000) = &lt;workflows.pdf_to_json.scripts.chapter_segmenter.ChapterSegmenter object at 0x16660d9d0&gt;.config

tests_unit/workflows/pdf_to_json/test_chapter_segmenter.py:260: AssertionError</failure></testcase><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPassB_TopicShift" name="test_similarity_threshold_tuning" time="0.023" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPassC_SyntheticSegmentation" name="test_always_returns_chapters" time="0.030" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPassC_SyntheticSegmentation" name="test_target_chapter_size_respected" time="0.058" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPassC_SyntheticSegmentation" name="test_synthetic_uses_heading_signals" time="0.029" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPassC_SyntheticSegmentation" name="test_max_chapters_limit_enforced" time="0.271" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestIntegration_ThreePassWorkflow" name="test_pass_a_success_skips_b_c" time="0.030" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestIntegration_ThreePassWorkflow" name="test_pass_a_fail_triggers_pass_b" time="0.021" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestIntegration_ThreePassWorkflow" name="test_pass_b_fail_triggers_pass_c" time="0.037" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestIntegration_ThreePassWorkflow" name="test_validation_rejects_bad_segmentation" time="0.018" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestIntegration_ThreePassWorkflow" name="test_empty_input_handled_gracefully" time="0.001" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestIntegration_ThreePassWorkflow" name="test_single_page_book_handled" time="0.002" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestEdgeCases" name="test_invalid_page_structure_handled" time="0.005" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestEdgeCases" name="test_very_short_pages_handled" time="0.002" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestEdgeCases" name="test_unicode_content_handled" time="0.013" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestEdgeCases" name="test_configuration_validation" time="0.000" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPerformance" name="test_large_book_performance" time="0.286" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPerformance" name="test_scalability[50]" time="0.030" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPerformance" name="test_scalability[100]" time="0.060" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPerformance" name="test_scalability[200]" time="0.115" /><testcase classname="tests_unit.workflows.pdf_to_json.test_chapter_segmenter.TestPerformance" name="test_scalability[500]" time="0.286" /></testsuite></testsuites>