INFO: Logging initialized - log file: /Users/kevintoles/POC/logs/llm_enhancement_20251112_013009.log
[llm_integration] Module loading started
[llm_integration] Environment variables loaded
[llm_integration] Basic imports done
[llm_integration] Attempting openai import...
[llm_integration] openai imported successfully
[llm_integration] Attempting anthropic import...
[llm_integration] anthropic imported successfully
[llm_integration] Module loading complete
[llm_integration] ‚úì Anthropic configured - Model: claude-sonnet-4-5-20250929
INFO: ‚úì LLM integration loaded successfully
/Users/kevintoles/POC/llm-document-enhancer/config/settings.py:260: UserWarning: TAXONOMY_MAX_BOOKS=10 may cause token issues. Estimated metadata tokens: 5000, max_tokens limit: 8192. Consider reducing TAXONOMY_MAX_BOOKS to 8 or less.
  warnings.warn(
INFO: ‚úì Interactive system loaded successfully (using TwoPhaseOrchestrator)
INFO: ==================================================================
INFO: Starting LLM Enhancement Workflow
INFO: ==================================================================
INFO: Loading companion book JSON files from Textbooks_JSON:
INFO: Loading companion books from: /Users/kevintoles/POC/llm-document-enhancer/data/textbooks_json
INFO: ‚úì Loaded 14 companion books successfully
INFO: Successfully loaded 14 companion books with 8598 total pages
INFO: Loading PYTHON_GUIDELINES_Learning_Python_Ed6.md...
INFO: ‚úì Loaded guidelines file: 1008967 characters
INFO: Initializing two-phase orchestrator (refactored architecture)...

======================================================================
  LLM Cross-Referencing System - V2 Interactive Metadata-First
======================================================================
  Provider: ANTHROPIC
  Model: claude-sonnet-4-5-20250929
  Temperature: 0.2
  Max Tokens: 8192
  Target: PYTHON_GUIDELINES_Learning_Python_Ed6.md
======================================================================

==================================================================
Comprehensive LLM Enhancement with All Companion Books
==================================================================
Loading companion book JSON files from Textbooks_JSON:
Loading from: /Users/kevintoles/POC/llm-document-enhancer/data/textbooks_json
  Loaded 497 pages from Architecture Patterns with Python
  Loaded 595 pages from Python Architecture Patterns
  Loaded 442 pages from Microservice APIs Using Python Flask FastAPI
  Loaded 319 pages from Microservices Up and Running
  Loaded 144 pages from Microservice Architecture
  Loaded 355 pages from Python Distilled
  Loaded 742 pages from Python Essential Reference 4th
  Loaded 582 pages from Python Data Analysis 3rd
  Loaded 1011 pages from Fluent Python 2nd
  Loaded 1978 pages from Learning Python Ed6
  Loaded 706 pages from Python Cookbook 3rd
  Loaded 334 pages from Python Microservices Development
  Loaded 420 pages from Building Python Microservices with FastAPI
  Loaded 473 pages from Building Microservices

üìö Successfully loaded 14 companion books with 8598 total pages
Using ANTHROPIC for comprehensive analysis
Loading PYTHON_GUIDELINES_Learning_Python_Ed6.md...

Initializing LLM orchestrator (this validates book metadata loading)...
Initializing two-phase orchestrator...
Loading companion book metadata...
  Loading Architecture Patterns with Python... ‚úì (497 pages)
  Loading Python Architecture Patterns... ‚úì (595 pages)
  Loading Microservice APIs Using Python Flask FastAPI... ‚úì (442 pages)
  Loading Microservices Up and Running... ‚úì (319 pages)
  Loading Microservice Architecture... ‚úì (144 pages)
  Loading Python Distilled... ‚úì (355 pages)
  Loading Python Essential Reference 4th... ‚úì (742 pages)
  Loading Python Data Analysis 3rd... ‚úì (582 pages)
  Loading Fluent Python 2nd... ‚úì (1011 pages)
  Loading Learning Python Ed6... ‚úì (1978 pages)
  Loading Python Cookbook 3rd... ‚úì (706 pages)
  Loading Python Microservices Development... ‚úì (334 pages)
  Loading Building Python Microservices with FastAPI... ‚úì (420 pages)
  Loading Building Microservices...INFO: ‚úì TwoPhaseOrchestrator initialized successfully
INFO: ‚úì Orchestrator can access 14 books
INFO: Loaded full document: 137774 words
INFO: Found 41 chapters (Chapter 1 - Chapter 41)
INFO: LIMITING to chapters 1-10 for testing: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
INFO: Running test on Chapter 1 to validate workflow before processing all chapters
INFO:    Testing LLM enhancement on Chapter 1...
 ‚úì (473 pages)
‚úì System ready (using refactored architecture)
  Note: Chapter metadata not available, using basic book metadata only
‚úì Orchestrator validated: 14 books accessible
Loaded full document: 137774 words

üìã Found 41 chapters (Chapter 1 - Chapter 41)
‚ö†Ô∏è  LIMITING to chapters 1-10 for testing: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

üß™ RUNNING TEST on Chapter 1 to validate workflow...
   Testing LLM enhancement on Chapter 1...

================================================================================
COMPREHENSIVE LLM ANALYSIS: Chapter 1 - A Python Q&A Session
================================================================================
  Note: Chapter metadata not available, using basic book metadata only

üìã PHASE 1: Concept Extraction & Book Identification
----------------------------------------
Sending full chapter text (22877 chars)
Book metadata for 14 books
Estimated tokens: ~3,477

[LLM] Making API call with model: claude-sonnet-4-5-20250929
[LLM] API logging enabled - saving to logs/llm_api/

[LLM API #1] Request: 3,477 estimated input tokens, 8,000 max output tokens
[LLM API #1] ‚úì Response: 2,398 output tokens, 3,477 input tokens (actual)
[LLM API #1] Response length: 9,542 chars
[LLM API] Logged to: api_call_001_20251112_013053.json

================================================================================
DEBUG: Raw Claude Response (Phase 1)
================================================================================
```json
{
  "concepts_extracted": [
    "bytecode compilation",
    "Python Virtual Machine (PVM)",
    "dynamic typing",
    "object-oriented programming",
    "functional programming",
    "class model",
    "polymorphism",
    "operator overloading",
    "multiple inheritance",
    "generators",
    "comprehensions",
    "closures",
    "decorators",
    "lambda functions",
    "first-class functions",
    "standard library",
    "portability",
    "execution model",
    "source code compilation",
    "intermediate representation",
    "runtime execution",
    "multi-paradigm programming",
    "software quality",
    "developer productivity",
    "readable syntax",
    "interactive programming",
    "rapid turnaround",
    "open source",
    "third-party extensions",
    "NumPy",
    "Django",
    "text pattern matching",
    "network scripting",
    "regular expressions",
    "command-line arguments",
    "standard streams",
    "shell commands",
    "files",
    "sockets",
    "pipes",
    "processes",
    "threads",
    "array operations",
    "concatenation",
    "slicing",
    "sorting",
    "mapping",
    "library utilities",
    "application-level programming"
  ],
  "themes_identified": [
    "Python's execution model and bytecode compilation pipeline",
    "Multi-paradigm programming support (OOP + functional)",
    "Language design philosophy: simplicity, readability, consistency",
    "Standard library and ecosystem extensibility",
    "Portability and cross-platform development",
    "Dynamic typing and runtime flexibility",
    "Developer productivity through interactive development",
    "Core language features: classes, functions, comprehensions, generators"
  ],
  "content_requests": [
    {
      "book_name": "Python Distilled",
      "chapters_or_sections": [
        "Chapter 1: Python Basics",
        "Chapter 2: Operators, Expressions, and Data Manipulation",
        "Chapter 5: Program Structure and Control Flow",
        "Chapter 7: Classes 

... (truncated, total length: 9542 chars)
================================================================================


[DEBUG] JSON parsed successfully
[DEBUG] Keys in response: ['concepts_extracted', 'themes_identified', 'content_requests', 'analysis_strategy']
[DEBUG] content_requests field: [{'book_name': 'Python Distilled', 'chapters_or_sections': ['Chapter 1: Python Basics', 'Chapter 2: Operators, Expressions, and Data Manipulation', 'Chapter 5: Program Structure and Control Flow', 'Chapter 7: Classes and Object-Oriented Programming', 'Chapter 8: Modules and Packages'], 'pages': [], 'rationale': "Beazley's distilled reference provides authoritative technical depth on Python's execution model, bytecode compilation, and core language features. His treatment of classes, functions, and the module system will offer precise technical cross-references to Learning Python's introductory Q&A. The concise format complements the tutorial approach.", 'priority': 1}, {'book_name': 'Fluent Python 2nd', 'chapters_or_sections': ['Chapter 1: The Python Data Model', 'Chapter 2: An Array of Sequences', 'Chapter 5: Data Class Builders', 'Chapter 7: Functions as First-Class Objects', 'Chapter 9: Decorators and Closures', 'Chapter 17: Iterators, Generators, and Classic Coroutines'], 'pages': [], 'rationale': "Ramalho's deep dive into Pythonic idioms directly extends the Q&A's mentions of first-class functions, closures, decorators, generators, and comprehensions. His data model chapter explains the 'object-oriented from the ground up' philosophy. Essential for showing how introductory concepts scale to advanced patterns.", 'priority': 1}, {'book_name': 'Python Essential Reference 4th', 'chapters_or_sections': ['Chapter 1: A Tutorial Introduction', 'Chapter 5: Program Structure and Control Flow', 'Chapter 6: Functions and Functional Programming', 'Chapter 7: Classes and Object-Oriented Programming', 'Chapter 8: Modules, Packages, and Distribution'], 'pages': [], 'rationale': "Beazley's reference work provides authoritative coverage of Python's execution model, compilation process, and runtime behavior. His treatment of functional programming features (lambdas, closures, first-class functions) and OOP (classes, inheritance, polymorphism) directly maps to the Q&A's technical claims. Critical for technical accuracy verification.", 'priority': 1}, {'book_name': 'Python Cookbook 3rd', 'chapters_or_sections': ['Chapter 1: Data Structures and Algorithms', 'Chapter 7: Functions', 'Chapter 8: Classes and Objects', 'Chapter 9: Metaprogramming'], 'pages': [], 'rationale': "Recipe-based approach shows practical application of concepts introduced in the Q&A: slicing, sorting, concatenation, decorators, closures, class design. The metaprogramming chapter extends the 'operator overloading' and 'polymorphism' mentions. Bridges theory to practice effectively.", 'priority': 2}, {'book_name': 'Python Data Analysis 3rd', 'chapters_or_sections': ['Chapter 1: Preliminaries', 'Chapter 2: Python Language Basics, IPython, and Jupyter Notebooks', 'Chapter 3: Built-In Data Structures, Functions, and Files', 'Chapter 4: NumPy Basics: Arrays and Vectorized Computation'], 'pages': [], 'rationale': "McKinney's work directly addresses NumPy (explicitly mentioned in the Q&A as elevating Python in STEM). His coverage of built-in data structures, functions, and files connects to the 'array of application-level programming tasks' theme. Shows Python's practical application in data science.", 'priority': 2}, {'book_name': 'Architecture Patterns with Python', 'chapters_or_sections': ['Chapter 1: Domain Modeling', 'Chapter 2: Repository Pattern', 'Chapter 3: A Brief Interlude: On Coupling and Abstractions'], 'pages': [], 'rationale': "Demonstrates how Python's OOP features (classes, polymorphism, inheritance) scale to architectural patterns. The coupling discussion relates to the Q&A's emphasis on 'consistent programming model' and software quality. Shows progression from language basics to system design.", 'priority': 3}, {'book_name': 'Microservice APIs Using Python Flask FastAPI', 'chapters_or_sections': ['Chapter 1: Introduction to Microservices', 'Chapter 2: Python Fundamentals', 'Chapter 3: Introduction to FastAPI'], 'pages': [], 'rationale': "Connects Python fundamentals to modern web development (Django mentioned in Q&A). Shows how language features (async, decorators, type hints) enable microservice architectures. Demonstrates 'network scripting' and 'application-level programming' in practice.", 'priority': 3}, {'book_name': 'Building Python Microservices with FastAPI', 'chapters_or_sections': ['Chapter 1: Setting Up FastAPI Application Development', 'Chapter 2: Exploring the Core Features', 'Chapter 3: Investigating Dependency Injection'], 'pages': [], 'rationale': "FastAPI heavily uses decorators, async/await, type hints, and dependency injection‚Äîall building on foundational concepts from the Q&A. Shows modern Python idioms in production systems. Complements the 'third-party domain offers tools for website construction' statement.", 'priority': 3}, {'book_name': 'Python Architecture Patterns', 'chapters_or_sections': ['Chapter 1: Introduction to Software Architecture', 'Chapter 2: Architectural Patterns', 'Chapter 3: Event-Driven Architectures'], 'pages': [], 'rationale': "Buelta's architectural perspective shows how Python's multi-paradigm nature (OOP + functional) supports different architectural styles. Event-driven patterns leverage generators, async, and functional programming features mentioned in the Q&A. Bridges language features to system design.", 'priority': 4}, {'book_name': 'Microservices Up and Running', 'chapters_or_sections': ['Chapter 1: Introduction', 'Chapter 3: Microservices API', 'Chapter 4: Microservices Patterns'], 'pages': [], 'rationale': "Demonstrates Python's role in microservices ecosystems, connecting to 'network scripting' and 'portability' themes. Shows how language features (async/await, comprehensions, lambdas) enable distributed systems. Provides architectural context for Python's design choices.", 'priority': 4}]
[DEBUG] Number of requests: 10
[DEBUG] ‚úì Found 10 content requests
‚úì LLM extracted concepts and identified 10 book chapters to review
  - Python Distilled: Beazley's distilled reference provides authoritative technical depth on Python's...
  - Fluent Python 2nd: Ramalho's deep dive into Pythonic idioms directly extends the Q&A's mentions of ...
  - Python Essential Reference 4th: Beazley's reference work provides authoritative coverage of Python's execution m...
  - Python Cookbook 3rd: Recipe-based approach shows practical application of concepts introduced in the ...
  - Python Data Analysis 3rd: McKinney's work directly addresses NumPy (explicitly mentioned in the Q&A as ele...

üìñ PHASE 2: Chapter Retrieval & Synthesis
----------------------------------------
  Lazy loading content from 10 requests...
Retrieved content from 0 books
Total excerpts: 0
Estimated tokens: ~925

[LLM API #2] Request: 925 estimated input tokens, 4,000 max output tokens
[LLM API #2] ‚úì Response: 459 output tokens, 863 input tokens (actual)
[LLM API #2] Response length: 2,658 chars
[LLM API] Logged to: api_call_002_20251112_013109.json
INFO: ‚úì Test successful: Generated 2658 char annotation
INFO: ‚úÖ ALL CRITICAL CHECKS PASSED - Proceeding with full enhancement
‚úì Generated annotation: 2658 chars
‚úì Sources cited: 0
‚úì Concepts validated: 10
‚úì TEST PASSED: Generated 2658 char annotation
‚úì Sources cited: 0
‚úì Ready to process all 10 chapters

‚úÖ ALL CRITICAL CHECKS PASSED
ÔøΩ Proceeding with full enhancement of 10 chapters...

‚ö†Ô∏è  This will make ~20 API calls (~600000 tokens). Continue? [y/N]: 